import ccxt
import datetime
from telegram import Bot
import time
from config import BINANCE_API_KEY, BINANCE_API_SECRET, TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID

# Initialize Binance client
binance = ccxt.binance({
    'apiKey': BINANCE_API_KEY,
    'secret': BINANCE_API_SECRET,
})

# Initialize Telegram Bot
telegram_bot = Bot(token=TELEGRAM_BOT_TOKEN)

# Function to fetch account balance
def get_account_balance():
    balance = binance.fetch_balance()
    return balance['total']['USDT']

# Function to send Telegram message
def send_telegram_message(message):
    telegram_bot.send_message(chat_id=TELEGRAM_CHAT_ID, text=message)

# Main function
def main():
    try:
        while True:
            current_balance = get_account_balance()
            # Get previous day's balance from file or database
            # For simplicity, let's assume we have a variable named 'previous_day_balance'
            # Replace it with your method to fetch previous day's balance
            previous_balance = 10000  # Replace this with the actual previous day's balance


            # Calculate the percentage change
            percentage_change = ((current_balance - previous_balance) / previous_balance) * 100

            # Check if the percentage change is greater than or equal to 5%
            if percentage_change >= 5:
                # Send an alert if the condition is met
                message = f"Alert: Balance increased by {percentage_change:.2f}% since the last check."
                send_telegram_message(message)
                print("Alert sent successfully.")

            previous_balance = current_balance  # Update previous balance

            time.sleep(300)  # Sleep for 5 seconds before the next iteration

    except Exception as e:
        print(f"Error fetching or sending alert: {e}")

# Run the main function
if __name__ == "__main__":
    main()